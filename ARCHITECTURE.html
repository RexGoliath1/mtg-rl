<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html"><link rel="search" title="Search" href="search.html"><link rel="next" title="Local Tools" href="tools.html"><link rel="prev" title="ForgeRL" href="README.html">

    <!-- Generated with Sphinx 9.1.0 and Furo 2025.12.19 -->
        <title>ForgeRL Architecture - ForgeRL</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=7bdb33bb" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">ForgeRL</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <span class="sidebar-brand-text">ForgeRL</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Project</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="README.html">ForgeRL</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">ForgeRL Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Local Tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/mechanics.html">Mechanics System</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/forge.html">Forge Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/training.html">Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/agents.html">Agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/data.html">Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/environments.html">Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/utils.html">Utils</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/ARCHITECTURE.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="forgerl-architecture">
<h1>ForgeRL Architecture<a class="headerlink" href="#forgerl-architecture" title="Link to this heading">¶</a></h1>
<section id="project-goals">
<h2>Project Goals<a class="headerlink" href="#project-goals" title="Link to this heading">¶</a></h2>
<p><strong>Goal 1: Gameplay Agent</strong> – Train one agent that plays Standard/Modern competitively, with Commander as a long-term target. The agent observes the full game state (hand, battlefield, graveyard, exile, stack) and selects actions across all phases of a turn.</p>
<p><strong>Goal 2: Deck Recommendations</strong> – Use simulated play to evaluate which decks and card combinations produce the highest win rates. Discover synergies that are hard for human deckbuilders to identify by running thousands of matchups in Forge.</p>
<p><strong>Goal 3: Turn Recommendations</strong> – Given a game in progress, recommend the best line of play for the current turn and future turns. This is the policy network applied as an advisory tool rather than an autonomous player.</p>
<p>All three goals share the same core: a neural network that understands MTG game states deeply enough to evaluate positions and select actions. The difference is how that network is deployed.</p>
</section>
<hr class="docutils" />
<section id="complexity-assessment">
<h2>Complexity Assessment<a class="headerlink" href="#complexity-assessment" title="Link to this heading">¶</a></h2>
<section id="how-mtg-compares-to-solved-games">
<h3>How MTG Compares to Solved Games<a class="headerlink" href="#how-mtg-compares-to-solved-games" title="Link to this heading">¶</a></h3>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Dimension</p></th>
<th class="head"><p>AlphaStar (SC2)</p></th>
<th class="head"><p>OpenAI Five (Dota 2)</p></th>
<th class="head"><p>Pluribus (Poker)</p></th>
<th class="head"><p>MTG (Modern 1v1)</p></th>
<th class="head"><p>MTG (Commander 4p)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Players</p></td>
<td><p>2</p></td>
<td><p>2 teams of 5</p></td>
<td><p>2-6</p></td>
<td><p>2</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>Entity types</p></td>
<td><p>~100 units</p></td>
<td><p>~120 heroes</p></td>
<td><p>52 cards</p></td>
<td><p>~5,000 played</p></td>
<td><p>~27,000 legal</p></td>
</tr>
<tr class="row-even"><td><p>Entities per game</p></td>
<td><p>~200</p></td>
<td><p>~100</p></td>
<td><p>2-7 cards</p></td>
<td><p>~60-100</p></td>
<td><p>~200-400</p></td>
</tr>
<tr class="row-odd"><td><p>Hidden info</p></td>
<td><p>Fog of war (~70%)</p></td>
<td><p>Fog of war</p></td>
<td><p>Hands (~90%)</p></td>
<td><p>Hands + libraries (~60%)</p></td>
<td><p>Hands + libraries (~60%)</p></td>
</tr>
<tr class="row-even"><td><p>Action space</p></td>
<td><p>~10^26</p></td>
<td><p>~10^20</p></td>
<td><p>~10^4 per hand</p></td>
<td><p>~10^5 per turn</p></td>
<td><p>~10^8 per turn</p></td>
</tr>
<tr class="row-odd"><td><p>Timing</p></td>
<td><p>Real-time</p></td>
<td><p>Real-time</p></td>
<td><p>Turn-based</p></td>
<td><p>Turn-based with priority</p></td>
<td><p>Turn-based with priority</p></td>
</tr>
<tr class="row-even"><td><p>Game length</p></td>
<td><p>~20 min, ~10K actions</p></td>
<td><p>~45 min, ~20K actions</p></td>
<td><p>~5 min, ~200 actions</p></td>
<td><p>~20 min, ~500 decisions</p></td>
<td><p>~60 min, ~2000 decisions</p></td>
</tr>
<tr class="row-odd"><td><p>Training data</p></td>
<td><p>Millions of replays</p></td>
<td><p>Millions of games</p></td>
<td><p>Self-play only</p></td>
<td><p>~50K games (17lands/Forge)</p></td>
<td><p>Very scarce</p></td>
</tr>
<tr class="row-even"><td><p>Model size</p></td>
<td><p>139M (55M inference)</p></td>
<td><p>159M</p></td>
<td><p>~1M (tabular)</p></td>
<td><p><strong>Target: 6-15M</strong></p></td>
<td><p><strong>Target: 10-30M</strong></p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Key insight:</strong> MTG Modern 1v1 is comparable in complexity to a simplified StarCraft – fewer real-time decisions but more entity types and deeper interaction rules. Commander 4-player is genuinely harder than anything solved to date in the card game domain, but tractable as an extension of the 1v1 system.</p>
</section>
<section id="what-makes-mtg-uniquely-hard">
<h3>What Makes MTG Uniquely Hard<a class="headerlink" href="#what-makes-mtg-uniquely-hard" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p><strong>Arbitrary card text.</strong> Unlike StarCraft where units have fixed abilities, MTG cards can say anything. The interaction space is combinatorial over card text, not just position and type.</p></li>
<li><p><strong>Stack-based priority.</strong> The stack is a LIFO queue where spells and abilities wait to resolve, and any player can respond at instant speed. This creates deeply branching game trees at every priority pass. No other game AI has had to handle this exact structure, though it is analogous to response timing in real-time games.</p></li>
<li><p><strong>Phase structure.</strong> Each turn has 12+ phases, each with priority windows. A single turn can involve dozens of decision points. The agent must learn “when to act” as well as “what to do.”</p></li>
<li><p><strong>Card pool size.</strong> 27,000+ Commander-legal cards means the representation must generalize – the agent will encounter cards in testing that it rarely or never saw in training.</p></li>
</ol>
</section>
</section>
<hr class="docutils" />
<section id="state-representation">
<h2>State Representation<a class="headerlink" href="#state-representation" title="Link to this heading">¶</a></h2>
<section id="per-card-encoding-mechanics-primitives-not-per-card-id">
<h3>Per-Card Encoding: Mechanics Primitives (Not Per-Card ID)<a class="headerlink" href="#per-card-encoding-mechanics-primitives-not-per-card-id" title="Link to this heading">¶</a></h3>
<p>The sparsity problem with 27,000+ unique cards is solved by encoding cards by their <strong>mechanical properties</strong>, not their identity. This is analogous to AlphaStar encoding units by (type, health, shield, abilities) rather than a unit name.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Lightning Bolt → [INSTANT_SPEED, DEAL_DAMAGE, TARGET_ANY]     + params: {damage: 3}
Shock          → [INSTANT_SPEED, DEAL_DAMAGE, TARGET_ANY]     + params: {damage: 2}
Grapeshot      → [SORCERY_SPEED, DEAL_DAMAGE, TARGET_ANY, STORM] + params: {damage: 1}
</pre></div>
</div>
<p>The network learns what <code class="docutils literal notranslate"><span class="pre">DEAL_DAMAGE</span> <span class="pre">+</span> <span class="pre">TARGET_ANY</span></code> means. New burn spells work automatically because they’re combinations of known primitives.</p>
<p><strong>Current vocabulary:</strong> 214 mechanics primitives, VOCAB_SIZE embedding dimension of 1,311. Covers ~70% of MTG mechanics well.</p>
<p><strong>Known gaps requiring work:</strong></p>
<ul class="simple">
<li><p><strong>Type filters:</strong> No way to encode “noncreature spell” vs “any spell” (these parse identically today)</p></li>
<li><p><strong>Magnitude storage:</strong> <code class="docutils literal notranslate"><span class="pre">+2/+0</span></code> loses the <code class="docutils literal notranslate"><span class="pre">0</span></code> because the parser only stores the first number found per pattern</p></li>
<li><p><strong>Conditional scoping:</strong> Delirium is listed as a flat mechanic, not linked to the specific abilities it gates</p></li>
<li><p><strong>Modal choices:</strong> No primitives for “choose one” or “choose X”</p></li>
<li><p><strong>Duration:</strong> No distinction between “until end of turn” and “as long as”</p></li>
</ul>
<p><strong>Validation plan:</strong> Run the parser against every Standard/Modern/Commander-legal card via Scryfall API. Measure confidence distribution. Target: &gt;90% of cards parse with confidence &gt;0.7.</p>
</section>
<section id="per-card-feature-vector">
<h3>Per-Card Feature Vector<a class="headerlink" href="#per-card-feature-vector" title="Link to this heading">¶</a></h3>
<p>Each card is encoded as <strong>1,363 dimensions</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Mechanics embedding: 1,311 dims  (binary presence of primitives, pre-computed in HDF5)
Numeric parameters:     20 dims  (CMC, power, toughness, damage values, counts)
Dynamic game state:     32 dims  (zone, tapped, attacking, counters, damage, modifiers)
                     ─────────
Total per card:      1,363 dims
</pre></div>
</div>
<p>Dynamic state captures what’s happening to the card right now (tapped, has counters, is attacking), while mechanics and parameters capture what the card <em>is</em>.</p>
</section>
<section id="zone-encoding-hierarchical-attention">
<h3>Zone Encoding: Hierarchical Attention<a class="headerlink" href="#zone-encoding-hierarchical-attention" title="Link to this heading">¶</a></h3>
<p>The game state is organized by zones. Each zone contains a variable number of cards. The full network architecture (33.1M parameters) is shown in the following diagram, generated from the actual PyTorch model via <code class="docutils literal notranslate"><span class="pre">scripts/generate_network_diagram.py</span></code>:</p>
<p><img alt="ForgeRL AlphaZero Network Architecture" src="docs/_static/network_architecture.png" /></p>
<p>The data flow through zone encoders, cross-zone attention, and output heads is detailed below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Per-Card Features (1,363 dims each)
         │
    ┌────┴────┐
    │ Zone    │  Self-attention (4 heads, 256 dim)
    │ Encoder │  Learns: card synergies within this zone
    └────┬────┘  Output: 256-dim zone embedding + per-card embeddings
         │
    Repeat for: Hand, Battlefield, Graveyard, Exile (shared weights)
         │
    ┌────┴────┐
    │ Stack   │  Self-attention with positional encoding (LIFO order)
    │ Encoder │  Learns: spell/ability interaction on stack
    └────┬────┘  Output: 256-dim stack embedding
         │
    ┌────┴────────────────────────────────────────┐
    │ Cross-Zone Attention (4 heads)               │
    │ Learns: inter-zone relationships             │
    │ (graveyard targets for reanimation,          │
    │  hand cards that interact with battlefield)  │
    └────┬────────────────────────────────────────┘
         │
    ┌────┴────┐
    │ Global  │  Life totals (binary), mana pools (per color),
    │ Encoder │  turn number, phase, active/priority player
    └────┬────┘  Output: 128-dim global embedding
         │
    ┌────┴────┐
    │ Combine │  Concatenate all → MLP → 512-dim state embedding
    └────┬────┘
         │
    512-dim game state vector
</pre></div>
</div>
<p>This is <strong>one network that sees everything</strong> – all zones, all players. The hierarchy is for parameter efficiency (6.3M params vs ~87M for naive flat encoding), not for modularity. Every zone embedding attends to every other zone through cross-zone attention.</p>
<p><strong>Why not separate networks per zone?</strong> The cross-zone attention layer already handles this. A card in hand only matters in context of the battlefield; a graveyard card only matters if something can reanimate it. These relationships are captured by attention, not by separate networks.</p>
</section>
<section id="hidden-information-strategy-ctde">
<h3>Hidden Information Strategy: CTDE<a class="headerlink" href="#hidden-information-strategy-ctde" title="Link to this heading">¶</a></h3>
<p>During training, use <strong>Centralized Training, Decentralized Execution</strong> (proven in PerfectDou, NeurIPS 2022):</p>
<ul class="simple">
<li><p><strong>Value network (critic):</strong> Sees ALL hands, including opponents’. This is possible because Forge provides complete game state. The critic learns better position evaluation from perfect information.</p></li>
<li><p><strong>Policy network (actor):</strong> Only sees what a legal player would see – own hand, all battlefields, graveyards, exile, stack, but NOT opponents’ hands or library contents.</p></li>
</ul>
<p>The critic “teaches” the policy through the advantage function during training. At inference (actual gameplay), only the policy is used, and it operates on legal observations only.</p>
<p>This approach requires <strong>an order of magnitude fewer training samples</strong> vs training blind (per PerfectDou results on DouDizhu).</p>
<p><strong>Implementation:</strong> The ForgeGameStateEncoder receives a <code class="docutils literal notranslate"><span class="pre">visibility_mask</span></code> parameter. During training, the critic encodes all zones for all players. The policy encodes all zones for self but only public zones (battlefield, graveyard, exile) for opponents.</p>
</section>
</section>
<hr class="docutils" />
<section id="action-representation">
<h2>Action Representation<a class="headerlink" href="#action-representation" title="Link to this heading">¶</a></h2>
<section id="current-flat-action-space-153-actions-masked">
<h3>Current: Flat Action Space (153 actions, masked)<a class="headerlink" href="#current-flat-action-space-153-actions-masked" title="Link to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PASS</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MULLIGAN</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">CONCEDE</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">CAST_SPELL</span><span class="p">:</span> <span class="mi">15</span> <span class="p">(</span><span class="n">by</span> <span class="n">hand</span> <span class="n">slot</span><span class="p">)</span>
<span class="n">ACTIVATE</span><span class="p">:</span> <span class="mi">50</span> <span class="p">(</span><span class="n">by</span> <span class="n">battlefield</span> <span class="n">slot</span><span class="p">)</span>
<span class="n">ATTACK</span><span class="p">:</span> <span class="mi">50</span> <span class="p">(</span><span class="n">by</span> <span class="n">battlefield</span> <span class="n">slot</span><span class="p">)</span>
<span class="n">BLOCK</span><span class="p">:</span> <span class="mi">50</span> <span class="p">(</span><span class="n">by</span> <span class="n">battlefield</span> <span class="n">slot</span><span class="p">)</span>
<span class="n">CHOOSE_TARGET</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="n">CHOOSE_MODE</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="n">PAY_COST</span><span class="p">:</span> <span class="mi">10</span>
</pre></div>
</div>
<p>This works for small games but does not scale to Commander (100+ permanents, 20+ cards in hand with effects like card draw).</p>
</section>
<section id="target-auto-regressive-decomposition-alphastar-style">
<h3>Target: Auto-Regressive Decomposition (AlphaStar-style)<a class="headerlink" href="#target-auto-regressive-decomposition-alphastar-style" title="Link to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Step 1: Action Type (softmax over ~8 options)
  → Pass priority
  → Play land
  → Cast spell from hand
  → Activate ability on battlefield
  → Declare attackers
  → Declare blockers
  → Special action (mulligan, concede)

Step 2: Source Selection (pointer network into zone)
  Conditioned on Step 1.
  → If &quot;Cast spell&quot;: pointer over hand card embeddings
  → If &quot;Activate ability&quot;: pointer over battlefield card embeddings
  → If &quot;Declare attackers&quot;: pointer over untapped creatures
  Masked by legal options.

Step 3: Mode/Additional Choice
  Conditioned on Steps 1+2.
  → If modal spell: which mode (softmax over modes)
  → If X spell: what X value
  → If kicked: pay kicker?

Step 4: Target Selection (pointer network into legal targets)
  Conditioned on Steps 1+2+3.
  → Pointer over all legal target entities (creatures, players, permanents)
  → Can be repeated for multi-target spells

Step 5: Mana Payment (optional, for complex cases)
  → Which lands to tap
  → Usually auto-resolved, but matters for multi-color mana bases
</pre></div>
</div>
<p>Each step outputs a probability distribution, conditioned on all previous steps. Training uses teacher forcing (provide ground-truth previous steps during behavioral cloning). The pointer networks select from <strong>actual entity embeddings</strong> in the game state, not fixed slots, so this scales to any board size.</p>
</section>
</section>
<hr class="docutils" />
<section id="training-pipeline">
<h2>Training Pipeline<a class="headerlink" href="#training-pipeline" title="Link to this heading">¶</a></h2>
<section id="phase-1-behavioral-cloning-imitation-learning">
<h3>Phase 1: Behavioral Cloning (Imitation Learning)<a class="headerlink" href="#phase-1-behavioral-cloning-imitation-learning" title="Link to this heading">¶</a></h3>
<p>Train the policy network to imitate the Forge AI’s decisions. This bootstraps the agent with basic competence – legal plays, reasonable card evaluation, basic combat math.</p>
<p><strong>Data collection:</strong> Run Forge in observation mode (<code class="docutils literal notranslate"><span class="pre">-o</span></code>). The AI plays itself. For each decision, store the full game state (all zones, all cards with mechanics embeddings) and the AI’s chosen action (as an index into the action list).</p>
<p><strong>What the agent learns:</strong></p>
<ul class="simple">
<li><p>When to play cards vs pass priority</p></li>
<li><p>Basic card evaluation (don’t waste removal on weak creatures)</p></li>
<li><p>Combat fundamentals (attack/block decisions)</p></li>
<li><p>Mana sequencing (tap lands correctly)</p></li>
</ul>
<p><strong>What it does NOT learn:</strong></p>
<ul class="simple">
<li><p>Optimal play (Forge AI is not perfect)</p></li>
<li><p>Long-term planning (BC is myopic – predict next action, not game strategy)</p></li>
<li><p>Meta knowledge (which decks beat which)</p></li>
</ul>
<p><strong>Data requirements:</strong> ~100K-500K decisions with full state encoding. At ~400 decisions/game, this is ~250-1250 games. Achievable in a few hours with Forge.</p>
<p><strong>Architecture note:</strong> The data collection script (<code class="docutils literal notranslate"><span class="pre">collect_ai_training_data.py</span></code>) currently stores only 17 scalar features. It must be upgraded to store full card-level state using the ForgeGameStateEncoder, or store raw JSON for on-the-fly encoding during training.</p>
</section>
<section id="phase-2-self-play-reinforcement-learning">
<h3>Phase 2: Self-Play Reinforcement Learning<a class="headerlink" href="#phase-2-self-play-reinforcement-learning" title="Link to this heading">¶</a></h3>
<p>Starting from the BC checkpoint, train via self-play with PPO. The agent plays against copies of itself (and past versions to prevent forgetting).</p>
<p><strong>Reward:</strong></p>
<ul class="simple">
<li><p>Terminal: +1 win, -1 loss</p></li>
<li><p>Intermediate (annealed): life differential, board presence, card advantage</p></li>
</ul>
<p><strong>MCTS integration:</strong> The policy network guides Monte Carlo Tree Search. For each decision:</p>
<ol class="arabic simple">
<li><p>Run N simulations (default 800) using PUCT selection</p></li>
<li><p>Policy prior guides exploration; value network evaluates leaf nodes</p></li>
<li><p>Select action based on visit counts</p></li>
</ol>
<p><strong>Self-play pool:</strong> Maintain a pool of past checkpoints. Each game randomly selects an opponent from the pool. This prevents strategy collapse (rock-paper-scissors cycling).</p>
</section>
<section id="phase-3-curriculum-and-format-scaling">
<h3>Phase 3: Curriculum and Format Scaling<a class="headerlink" href="#phase-3-curriculum-and-format-scaling" title="Link to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Stage 1: Simplified Modern (50-card pool, no instants)
  → Learn: basic creatures, combat, land drops, sorcery-speed spells

Stage 2: Full Modern (5,000-card pool, all card types)
  → Learn: instant-speed interaction, stack usage, complex triggers

Stage 3: Commander 1v1 (27,000-card pool, 100-card singleton)
  → Learn: commander tax, larger boards, longer games, wider card diversity

Stage 4: Commander 4-player (future)
  → Learn: multi-opponent evaluation, threat assessment
  → Uses CTDE with 4-player value head (softmax over win probability per player)
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="parameter-budget-and-practicality">
<h2>Parameter Budget and Practicality<a class="headerlink" href="#parameter-budget-and-practicality" title="Link to this heading">¶</a></h2>
<section id="current-architecture-6-3m-parameters">
<h3>Current Architecture: 6.3M Parameters<a class="headerlink" href="#current-architecture-6-3m-parameters" title="Link to this heading">¶</a></h3>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Component</p></th>
<th class="head"><p>Parameters</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Zone Encoders (x4)</p></td>
<td><p>3,773,440</p></td>
<td><p>Self-attention over cards per zone</p></td>
</tr>
<tr class="row-odd"><td><p>Stack Encoder</p></td>
<td><p>682,340</p></td>
<td><p>LIFO-ordered attention</p></td>
</tr>
<tr class="row-even"><td><p>Global Encoder</p></td>
<td><p>29,472</p></td>
<td><p>Life, mana, turn, phase</p></td>
</tr>
<tr class="row-odd"><td><p>Cross-Zone Attention</p></td>
<td><p>395,264</p></td>
<td><p>Inter-zone relationships</p></td>
</tr>
<tr class="row-even"><td><p>Combine Network</p></td>
<td><p>986,112</p></td>
<td><p>Final aggregation to 512-dim</p></td>
</tr>
<tr class="row-odd"><td><p>Policy Head</p></td>
<td><p>237,465</p></td>
<td><p>Action selection</p></td>
</tr>
<tr class="row-even"><td><p>Value Head</p></td>
<td><p>198,401</p></td>
<td><p>Position evaluation</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Total</strong></p></td>
<td><p><strong>6,302,494</strong></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="scaling-for-commander">
<h3>Scaling for Commander<a class="headerlink" href="#scaling-for-commander" title="Link to this heading">¶</a></h3>
<p>Commander needs larger zone capacities (100 battlefield permanents vs 50):</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Config</p></th>
<th class="head"><p>Encoder Params</p></th>
<th class="head"><p>Total</p></th>
<th class="head"><p>Inference Latency</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Modern 1v1 (current)</p></td>
<td><p>5.9M</p></td>
<td><p>6.3M</p></td>
<td><p>~3ms</p></td>
</tr>
<tr class="row-odd"><td><p>Commander 1v1 (scaled zones)</p></td>
<td><p>~8.5M</p></td>
<td><p>~9M</p></td>
<td><p>~5ms</p></td>
</tr>
<tr class="row-even"><td><p>Commander 4p (4x player encoding)</p></td>
<td><p>~15M</p></td>
<td><p>~16M</p></td>
<td><p>~8ms</p></td>
</tr>
<tr class="row-odd"><td><p>With auto-regressive action head</p></td>
<td><p>+2-5M</p></td>
<td><p>~20M</p></td>
<td><p>~12ms</p></td>
</tr>
</tbody>
</table>
</div>
<p>All configurations are well within practical limits. AlphaStar uses 55M parameters at inference with no issues. AlphaZero chess uses ~25-45M. The sweet spot for card game AI appears to be 5-50M parameters.</p>
</section>
<section id="inference-during-gameplay">
<h3>Inference During Gameplay<a class="headerlink" href="#inference-during-gameplay" title="Link to this heading">¶</a></h3>
<p>Measured on Apple Silicon MPS (CUDA will be faster):</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Batch Size</p></th>
<th class="head"><p>Latency</p></th>
<th class="head"><p>Throughput</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1 (single decision)</p></td>
<td><p>2.78ms</p></td>
<td><p>360/sec</p></td>
</tr>
<tr class="row-odd"><td><p>32 (MCTS batch)</p></td>
<td><p>0.30ms/sample</p></td>
<td><p>107K/sec</p></td>
</tr>
</tbody>
</table>
</div>
<p>Even with 800 MCTS simulations per decision, each requiring a forward pass, total think time per move is ~240ms batched. This is fast enough for real-time play recommendations.</p>
</section>
</section>
<hr class="docutils" />
<section id="deck-recommendation-system-goal-2">
<h2>Deck Recommendation System (Goal 2)<a class="headerlink" href="#deck-recommendation-system-goal-2" title="Link to this heading">¶</a></h2>
<p><strong>Approach:</strong> Run round-robin tournaments in Forge between candidate decks. Use win rates to evaluate deck quality. The same policy network that plays games also evaluates positions during games, providing insight into <em>why</em> certain decks win.</p>
<p><strong>Architecture:</strong></p>
<ol class="arabic simple">
<li><p><strong>Meta snapshot:</strong> Scrape current meta decks from MTGGoldfish</p></li>
<li><p><strong>Tournament simulation:</strong> Play all pairwise matchups (N decks = N*(N-1)/2 matchups, K games each)</p></li>
<li><p><strong>Win rate matrix:</strong> Which deck beats which, and by how much</p></li>
<li><p><strong>Card impact analysis:</strong> Which cards appear most in winning board states (via attention weights or ablation)</p></li>
<li><p><strong>Deck generation (future):</strong> Use the card encoder to propose new deck compositions that fill gaps in the meta</p></li>
</ol>
<p><strong>Reference:</strong> Q-DeckRec (IEEE CIG 2018) uses Deep Q-Networks for deck construction as combinatorial optimization. Our approach is different – we use gameplay simulation rather than abstract optimization, which captures emergent synergies that static analysis misses.</p>
</section>
<hr class="docutils" />
<section id="key-references">
<h2>Key References<a class="headerlink" href="#key-references" title="Link to this heading">¶</a></h2>
<section id="directly-applicable">
<h3>Directly Applicable<a class="headerlink" href="#directly-applicable" title="Link to this heading">¶</a></h3>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Paper</p></th>
<th class="head"><p>Year</p></th>
<th class="head"><p>Relevance</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference external" href="https://arxiv.org/abs/2203.16406">PerfectDou</a></p></td>
<td><p>2022</p></td>
<td><p>CTDE for card games – train critic with perfect info, policy with partial</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://arxiv.org/abs/2003.13590">Suphx</a></p></td>
<td><p>2020</p></td>
<td><p>4-player Mahjong with oracle guiding and feature dropout</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://www.nature.com/articles/s41586-019-1724-z">AlphaStar</a></p></td>
<td><p>2019</p></td>
<td><p>Entity encoder + pointer network + auto-regressive actions</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://arxiv.org/abs/2303.05197">Mastering Hearthstone</a></p></td>
<td><p>2023</p></td>
<td><p>Shared card embeddings + auto-regressive action decomposition</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://arxiv.org/html/2407.05879v1">Generalised Card Representations</a></p></td>
<td><p>2024</p></td>
<td><p>Property-based card encoding for MTG (transfers to unseen cards)</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://arxiv.org/abs/1806.09771">Q-DeckRec</a></p></td>
<td><p>2018</p></td>
<td><p>RL-based deck recommendation for CCGs</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://www.science.org/doi/10.1126/sciadv.adg3256">Student of Games</a></p></td>
<td><p>2023</p></td>
<td><p>Unified perfect/imperfect information game algorithm</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="architecture-foundations">
<h3>Architecture Foundations<a class="headerlink" href="#architecture-foundations" title="Link to this heading">¶</a></h3>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Paper</p></th>
<th class="head"><p>Year</p></th>
<th class="head"><p>Relevance</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference external" href="https://proceedings.mlr.press/v97/lee19d.html">Set Transformer</a></p></td>
<td><p>2019</p></td>
<td><p>Attention-based encoding for variable-size sets</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://cdn.openai.com/dota-2.pdf">OpenAI Five</a></p></td>
<td><p>2019</p></td>
<td><p>Monolithic LSTM approach (159M params) – proves flat architectures work</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://arxiv.org/html/2404.16689v1">ByteRL</a></p></td>
<td><p>2024</p></td>
<td><p>Conv1D + LSTM for card game state</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="multi-player-imperfect-information">
<h3>Multi-Player / Imperfect Information<a class="headerlink" href="#multi-player-imperfect-information" title="Link to this heading">¶</a></h3>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Paper</p></th>
<th class="head"><p>Year</p></th>
<th class="head"><p>Relevance</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference external" href="https://www.science.org/doi/10.1126/science.aay2400">Pluribus</a></p></td>
<td><p>2019</p></td>
<td><p>6-player poker without alliance modeling</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://arxiv.org/abs/2007.13544">ReBeL</a></p></td>
<td><p>2020</p></td>
<td><p>Deep RL + search for imperfect info games</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://cdn.aaai.org/ojs/20394/20394-13-24407-1-2-20220628.pdf">AlphaHoldem</a></p></td>
<td><p>2022</p></td>
<td><p>End-to-end self-play for poker</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<hr class="docutils" />
<section id="development-workstreams">
<h2>Development Workstreams<a class="headerlink" href="#development-workstreams" title="Link to this heading">¶</a></h2>
<p>The project splits naturally into three independent workstreams that can be developed in parallel by separate agents:</p>
<section id="workstream-a-card-encoding-vocabulary-src-mechanics">
<h3>Workstream A: Card Encoding &amp; Vocabulary (src/mechanics/)<a class="headerlink" href="#workstream-a-card-encoding-vocabulary-src-mechanics" title="Link to this heading">¶</a></h3>
<p><strong>Goal:</strong> Ensure every MTG card can be accurately decomposed into mechanics primitives.</p>
<p><strong>Key tasks:</strong></p>
<ul class="simple">
<li><p>Validate vocabulary against full Scryfall card database</p></li>
<li><p>Add missing primitives (type filters, modal choices, duration markers)</p></li>
<li><p>Fix magnitude extraction (store power/toughness changes separately)</p></li>
<li><p>Add conditional scoping (link conditions to the effects they gate)</p></li>
<li><p>Write unit tests with tricky cards (Dragon’s Rage Channeler, Cryptic Command, Omnath)</p></li>
<li><p>Benchmark parser confidence across Standard/Modern/Commander card pools</p></li>
</ul>
<p><strong>Files:</strong> <code class="docutils literal notranslate"><span class="pre">src/mechanics/vocabulary.py</span></code>, <code class="docutils literal notranslate"><span class="pre">src/mechanics/card_parser.py</span></code>, <code class="docutils literal notranslate"><span class="pre">src/mechanics/precompute_embeddings.py</span></code></p>
</section>
<section id="workstream-b-data-pipeline-training-scripts-src-training">
<h3>Workstream B: Data Pipeline &amp; Training (scripts/, src/training/)<a class="headerlink" href="#workstream-b-data-pipeline-training-scripts-src-training" title="Link to this heading">¶</a></h3>
<p><strong>Goal:</strong> Collect rich training data from Forge and train the imitation learning model.</p>
<p><strong>Key tasks:</strong></p>
<ul class="simple">
<li><p>Upgrade <code class="docutils literal notranslate"><span class="pre">collect_ai_training_data.py</span></code> to store full card-level state (not 17 scalars)</p></li>
<li><p>Implement auto-regressive action encoding (action type → source card → target)</p></li>
<li><p>Train behavioral cloning model on Forge AI data</p></li>
<li><p>Implement CTDE (critic sees all hands, policy sees legal observations)</p></li>
<li><p>Set up self-play training loop with PPO</p></li>
<li><p>Cloud deployment for training runs</p></li>
</ul>
<p><strong>Files:</strong> <code class="docutils literal notranslate"><span class="pre">scripts/collect_ai_training_data.py</span></code>, <code class="docutils literal notranslate"><span class="pre">scripts/train_imitation.py</span></code>, <code class="docutils literal notranslate"><span class="pre">src/training/self_play.py</span></code>, <code class="docutils literal notranslate"><span class="pre">src/forge/game_state_encoder.py</span></code>, <code class="docutils literal notranslate"><span class="pre">src/forge/policy_value_heads.py</span></code></p>
</section>
<section id="workstream-c-infrastructure-forge-integration-infrastructure-forge-repo">
<h3>Workstream C: Infrastructure &amp; Forge Integration (infrastructure/, forge-repo/)<a class="headerlink" href="#workstream-c-infrastructure-forge-integration-infrastructure-forge-repo" title="Link to this heading">¶</a></h3>
<p><strong>Goal:</strong> Reliable cloud training infrastructure and stable Forge communication.</p>
<p><strong>Key tasks:</strong></p>
<ul class="simple">
<li><p>Terraform modules for different training modes</p></li>
<li><p>Docker builds for Forge daemon + training</p></li>
<li><p>Forge daemon stability (handle long games, timeouts, reconnection)</p></li>
<li><p>S3 data pipeline (collection → storage → training)</p></li>
<li><p>Monitoring and cost controls</p></li>
</ul>
<p><strong>Files:</strong> <code class="docutils literal notranslate"><span class="pre">infrastructure/</span></code>, <code class="docutils literal notranslate"><span class="pre">scripts/deploy_*.sh</span></code>, <code class="docutils literal notranslate"><span class="pre">src/forge/forge_client.py</span></code>, <code class="docutils literal notranslate"><span class="pre">infrastructure/docker/Dockerfile.*</span></code></p>
</section>
</section>
<hr class="docutils" />
<section id="current-status-and-next-steps">
<h2>Current Status and Next Steps<a class="headerlink" href="#current-status-and-next-steps" title="Link to this heading">¶</a></h2>
<section id="what-exists-and-works">
<h3>What Exists and Works<a class="headerlink" href="#what-exists-and-works" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>[x] ForgeGameStateEncoder (5.9M params, hierarchical attention) – <code class="docutils literal notranslate"><span class="pre">src/forge/game_state_encoder.py</span></code></p></li>
<li><p>[x] Policy/Value heads with action masking – <code class="docutils literal notranslate"><span class="pre">src/forge/policy_value_heads.py</span></code></p></li>
<li><p>[x] MCTS integration – <code class="docutils literal notranslate"><span class="pre">src/forge/mcts.py</span></code></p></li>
<li><p>[x] Forge TCP client – <code class="docutils literal notranslate"><span class="pre">src/forge/forge_client.py</span></code></p></li>
<li><p>[x] Mechanics vocabulary (214 primitives) – <code class="docutils literal notranslate"><span class="pre">src/mechanics/vocabulary.py</span></code></p></li>
<li><p>[x] Card text parser – <code class="docutils literal notranslate"><span class="pre">src/mechanics/card_parser.py</span></code></p></li>
<li><p>[x] Pre-computed card embeddings – <code class="docutils literal notranslate"><span class="pre">src/mechanics/precompute_embeddings.py</span></code></p></li>
<li><p>[x] Parallel self-play framework – <code class="docutils literal notranslate"><span class="pre">src/training/parallel_selfplay.py</span></code></p></li>
<li><p>[x] AWS infrastructure (Terraform, ECR, S3) – <code class="docutils literal notranslate"><span class="pre">infrastructure/</span></code></p></li>
<li><p>[x] Data collection from Forge (basic) – <code class="docutils literal notranslate"><span class="pre">scripts/collect_ai_training_data.py</span></code></p></li>
</ul>
</section>
<section id="what-needs-work-priority-order">
<h3>What Needs Work (Priority Order)<a class="headerlink" href="#what-needs-work-priority-order" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p><strong>Data collection upgrade</strong> – Store full card-level state, not 17 scalars</p></li>
<li><p><strong>Vocabulary validation</strong> – Test against full card pool, fill gaps</p></li>
<li><p><strong>Auto-regressive action head</strong> – Replace flat 153-action softmax with pointer networks</p></li>
<li><p><strong>CTDE implementation</strong> – Split critic/actor visibility for training</p></li>
<li><p><strong>Behavioral cloning training</strong> – End-to-end with rich state encoding</p></li>
<li><p><strong>Self-play fine-tuning</strong> – PPO on top of BC checkpoint</p></li>
<li><p><strong>Deck tournament system</strong> – Round-robin simulation for meta analysis</p></li>
</ol>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="tools.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Local Tools</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="README.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">ForgeRL</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2026, ForgeRL Contributors
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">ForgeRL Architecture</a><ul>
<li><a class="reference internal" href="#project-goals">Project Goals</a></li>
<li><a class="reference internal" href="#complexity-assessment">Complexity Assessment</a><ul>
<li><a class="reference internal" href="#how-mtg-compares-to-solved-games">How MTG Compares to Solved Games</a></li>
<li><a class="reference internal" href="#what-makes-mtg-uniquely-hard">What Makes MTG Uniquely Hard</a></li>
</ul>
</li>
<li><a class="reference internal" href="#state-representation">State Representation</a><ul>
<li><a class="reference internal" href="#per-card-encoding-mechanics-primitives-not-per-card-id">Per-Card Encoding: Mechanics Primitives (Not Per-Card ID)</a></li>
<li><a class="reference internal" href="#per-card-feature-vector">Per-Card Feature Vector</a></li>
<li><a class="reference internal" href="#zone-encoding-hierarchical-attention">Zone Encoding: Hierarchical Attention</a></li>
<li><a class="reference internal" href="#hidden-information-strategy-ctde">Hidden Information Strategy: CTDE</a></li>
</ul>
</li>
<li><a class="reference internal" href="#action-representation">Action Representation</a><ul>
<li><a class="reference internal" href="#current-flat-action-space-153-actions-masked">Current: Flat Action Space (153 actions, masked)</a></li>
<li><a class="reference internal" href="#target-auto-regressive-decomposition-alphastar-style">Target: Auto-Regressive Decomposition (AlphaStar-style)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#training-pipeline">Training Pipeline</a><ul>
<li><a class="reference internal" href="#phase-1-behavioral-cloning-imitation-learning">Phase 1: Behavioral Cloning (Imitation Learning)</a></li>
<li><a class="reference internal" href="#phase-2-self-play-reinforcement-learning">Phase 2: Self-Play Reinforcement Learning</a></li>
<li><a class="reference internal" href="#phase-3-curriculum-and-format-scaling">Phase 3: Curriculum and Format Scaling</a></li>
</ul>
</li>
<li><a class="reference internal" href="#parameter-budget-and-practicality">Parameter Budget and Practicality</a><ul>
<li><a class="reference internal" href="#current-architecture-6-3m-parameters">Current Architecture: 6.3M Parameters</a></li>
<li><a class="reference internal" href="#scaling-for-commander">Scaling for Commander</a></li>
<li><a class="reference internal" href="#inference-during-gameplay">Inference During Gameplay</a></li>
</ul>
</li>
<li><a class="reference internal" href="#deck-recommendation-system-goal-2">Deck Recommendation System (Goal 2)</a></li>
<li><a class="reference internal" href="#key-references">Key References</a><ul>
<li><a class="reference internal" href="#directly-applicable">Directly Applicable</a></li>
<li><a class="reference internal" href="#architecture-foundations">Architecture Foundations</a></li>
<li><a class="reference internal" href="#multi-player-imperfect-information">Multi-Player / Imperfect Information</a></li>
</ul>
</li>
<li><a class="reference internal" href="#development-workstreams">Development Workstreams</a><ul>
<li><a class="reference internal" href="#workstream-a-card-encoding-vocabulary-src-mechanics">Workstream A: Card Encoding &amp; Vocabulary (src/mechanics/)</a></li>
<li><a class="reference internal" href="#workstream-b-data-pipeline-training-scripts-src-training">Workstream B: Data Pipeline &amp; Training (scripts/, src/training/)</a></li>
<li><a class="reference internal" href="#workstream-c-infrastructure-forge-integration-infrastructure-forge-repo">Workstream C: Infrastructure &amp; Forge Integration (infrastructure/, forge-repo/)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#current-status-and-next-steps">Current Status and Next Steps</a><ul>
<li><a class="reference internal" href="#what-exists-and-works">What Exists and Works</a></li>
<li><a class="reference internal" href="#what-needs-work-priority-order">What Needs Work (Priority Order)</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=01f34227"></script>
    <script src="_static/doctools.js?v=fd6eb6e6"></script>
    <script src="_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>